(()=>{var dt=Object.defineProperty;var Ot=(n,t,e)=>t in n?dt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Ct=(n,t)=>{for(var e in t)dt(n,e,{get:t[e],enumerable:!0})};var l=(n,t,e)=>(Ot(n,typeof t!="symbol"?t+"":t,e),e),wt=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var F=(n,t,e)=>(wt(n,t,"read from private field"),e?e.call(n):t.get(n)),E=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},A=(n,t,e,i)=>(wt(n,t,"write to private field"),i?i.call(n,e):t.set(n,e),e);var h=(n,t,e)=>(wt(n,t,"access private method"),e);var c,I,x,u,y=class{constructor(){E(this,x);E(this,c,void 0);E(this,I,void 0);A(this,c,new DataView(new ArrayBuffer(y.blockByteLength))),A(this,I,0)}getBuffer(){return F(this,c).buffer.slice(0,F(this,I))}writeBuffer(t){h(this,x,u).call(this,t.byteLength,()=>{let e=new Uint8Array(t),i=F(this,I);for(let s=0;s<e.length;s++)F(this,c).setUint8(i++,e[s])})}writeUint8(t){h(this,x,u).call(this,1,()=>{F(this,c).setUint8(F(this,I),t)})}writeUint16(t){h(this,x,u).call(this,2,()=>{F(this,c).setUint16(F(this,I),t,!1)})}writeUint32(t){h(this,x,u).call(this,4,()=>{F(this,c).setUint32(F(this,I),t,!1)})}writeUint64(t){h(this,x,u).call(this,8,()=>{F(this,c).setBigUint64(F(this,I),t,!1)})}writeInt8(t){h(this,x,u).call(this,1,()=>{F(this,c).setInt8(F(this,I),t)})}writeInt16(t){h(this,x,u).call(this,2,()=>{F(this,c).setInt16(F(this,I),t,!1)})}writeInt32(t){h(this,x,u).call(this,4,()=>{F(this,c).setInt32(F(this,I),t,!1)})}writeInt64(t){h(this,x,u).call(this,8,()=>{F(this,c).setBigInt64(F(this,I),t,!1)})}writeFloat64(t){h(this,x,u).call(this,8,()=>{F(this,c).setFloat64(F(this,I),t,!1)})}},U=y;c=new WeakMap,I=new WeakMap,x=new WeakSet,u=function(t=0,e){if(F(this,I)+t>=F(this,c).buffer.byteLength){let i=Math.ceil((F(this,c).buffer.byteLength+t)/y.blockByteLength)*y.blockByteLength,s=new ArrayBuffer(i);new Uint8Array(s).set(new Uint8Array(F(this,c).buffer)),A(this,c,new DataView(s))}e(),A(this,I,F(this,I)+t)},l(U,"blockByteLength",256);var Xt={};Ct(Xt,{ARRAY16_PREFIX:()=>Q,ARRAY32_PREFIX:()=>W,BIN16_PREFIX:()=>T,BIN32_PREFIX:()=>L,BIN8_PREFIX:()=>P,BOOL_FALSE:()=>et,BOOL_TRUE:()=>R,EXT16_PREFIX:()=>N,EXT32_PREFIX:()=>B,EXT8_PREFIX:()=>d,EXT_TYPE_TIMESTAMP:()=>g,FIXEXT16_PREFIX:()=>K,FIXEXT1_PREFIX:()=>z,FIXEXT2_PREFIX:()=>$,FIXEXT4_PREFIX:()=>j,FIXEXT8_PREFIX:()=>H,FLOAT32_PREFIX:()=>Ft,FLOAT64_PREFIX:()=>_,INT16_PREFIX:()=>O,INT32_PREFIX:()=>C,INT64_PREFIX:()=>Y,INT8_PREFIX:()=>D,MAP16_PREFIX:()=>Z,MAP32_PREFIX:()=>V,NIL:()=>tt,STR16_PREFIX:()=>G,STR32_PREFIX:()=>J,STR8_PREFIX:()=>q,UINT16_PREFIX:()=>M,UINT32_PREFIX:()=>S,UINT64_PREFIX:()=>k,UINT8_PREFIX:()=>m});var tt=192,et=194,R=195,P=196,T=197,L=198,d=199,N=200,B=201,Ft=202,_=203,m=204,M=205,S=206,k=207,D=208,O=209,C=210,Y=211,z=212,$=213,j=214,H=215,K=216,q=217,G=218,J=219,Q=220,W=221,Z=222,V=223,g=-1;var w=class{static fromDate(t){let e=Math.floor(t.valueOf()/1e3),i=(t.valueOf()-e*1e3)*1e6;return new w(e,i)}constructor(t,e=0){this.sec=t,this.nsec=e}toDate(){return new Date(this.sec*1e3+Math.floor(this.nsec/1e6))}};function Ut(n,t=!1){let e=new U;pt(e,n);let i=e.getBuffer();return t&&console.debug(i),i}function pt(n,t){switch(typeof t){case"boolean":Yt(n,t);break;case"bigint":Nt(n,t);break;case"number":Number.isInteger(t)?Nt(n,t):zt(n,t);break;case"string":Bt(n,t);break;case"object":if(t===null){n.writeUint8(192);break}if(t instanceof Date){Kt(n,t);break}if(t instanceof ArrayBuffer){$t(n,t);break}if(Array.isArray(t)){jt(n,t);for(let e of t)pt(n,e);break}Ht(n,t);for(let[e,i]of t instanceof Map?t.entries():Object.entries(t))Bt(n,e),pt(n,i);break;default:console.debug("noop",t);break}}function Yt(n,t=!0){t?n.writeUint8(195):n.writeUint8(194)}function Nt(n,t=0){if(t>=0&&t<=127){n.writeUint8(t);return}if(t<0&&t>=-32){n.writeInt8(t);return}if(t>0){if(t<=255){n.writeUint8(204),n.writeUint8(t);return}if(t<=65535){n.writeUint8(205),n.writeUint16(t);return}if(t<=4294967295){n.writeUint8(206),n.writeUint32(t);return}n.writeUint8(207),n.writeUint64(t);return}if(t<0){if(-t<=255){n.writeUint8(208),n.writeInt8(t);return}if(-t<=65535){n.writeUint8(209),n.writeInt16(t);return}if(-t<=4294967295){n.writeUint8(210),n.writeInt32(t);return}n.writeUint8(211),n.writeInt64(t)}}function zt(n,t=0){n.writeUint8(203),n.writeFloat64(t)}function Bt(n,t=""){let e=new TextEncoder().encode(t),i=e.byteLength;if(i<=31){n.writeUint8(160+i),n.writeBuffer(e);return}if(i<255){n.writeUint8(217),n.writeUint8(i),n.writeBuffer(e);return}if(i<65535){n.writeUint8(218),n.writeUint16(i),n.writeBuffer(e);return}if(i<4294967295){n.writeUint8(219),n.writeUint32(i),n.writeBuffer(e);return}throw new Error("Length of string value cannot exceed (2^32)-1.")}function $t(n,t){let e=t.byteLength;if(e<255){n.writeUint8(196),n.writeUint8(e),n.writeBuffer(t);return}if(e<65535){n.writeUint8(197),n.writeUint16(e),n.writeBuffer(t);return}if(e<4294967295){n.writeUint8(198),n.writeUint32(e),n.writeBuffer(t);return}throw new Error("Length of binary value cannot exceed (2^32)-1.")}function jt(n,t={}){let e=t.length;if(e<15){n.writeUint8(144+e);return}if(e<65535){n.writeUint8(220),n.writeUint16(e);return}if(e<4294967295){n.writeUint8(221),n.writeUint32(e);return}throw new Error("Number of elements cannot exceed (2^32)-1.")}function Ht(n,t={}){let e=t instanceof Map?t.size:Object.keys(t).length;if(e<15){n.writeUint8(128+e);return}if(e<65535){n.writeUint8(222),n.writeUint16(e);return}if(e<4294967295){n.writeUint8(223),n.writeUint32(e);return}throw new Error("Number of pairs cannot exceed (2^32)-1.")}function Kt(n,t){let e=w.fromDate(t);if(e.nsec>1e9)throw new Error("Nanoseconds cannot be larger than 999999999.");if(e.sec>=0&&e.sec<=4294967295)if(e.nsec===0){let i=new DataView(new ArrayBuffer(4));i.setUint32(0,Number(e.sec),!1),gt(n,-1,i.buffer)}else{let i=(BigInt(e.nsec)<<34n)+BigInt(e.sec),s=new DataView(new ArrayBuffer(8));s.setBigUint64(0,i,!1),gt(n,-1,s.buffer)}else{let i=new DataView(new ArrayBuffer(12));i.setUint32(0,e.nsec,!1),i.setBigInt64(4,BigInt(e.sec),!1),gt(n,-1,i.buffer)}}function gt(n,t,e){let i=e.byteLength;if(i===1){n.writeUint8(212),n.writeInt8(t),n.writeBuffer(e);return}else if(i===2){n.writeUint8(213),n.writeInt8(t),n.writeBuffer(e);return}else if(i===4){n.writeUint8(214),n.writeInt8(t),n.writeBuffer(e);return}else if(i===8){n.writeUint8(215),n.writeInt8(t),n.writeBuffer(e);return}else if(i===16){n.writeUint8(216),n.writeInt8(t),n.writeBuffer(e);return}if(i<255){n.writeUint8(199),n.writeUint8(i),n.writeInt8(t),n.writeBuffer(e);return}else if(i<65535){n.writeUint8(200),n.writeUint16(i),n.writeInt8(t),n.writeBuffer(e);return}else if(i<4294967295){n.writeUint8(201),n.writeUint32(i),n.writeInt8(t),n.writeBuffer(e);return}throw new Error("Ext does not support data exceeding 2**32-1 bytes.")}var nt=class{constructor(t,e=!0,i=!1,s=0){this.ref=t,this.isMap=e,this.isArray=i,this.elementsLeft=s}};var b,rt,lt,_t,It,mt,Et,Mt,it,Rt,at,St,st,Pt,ot,Tt,xt,kt,v,ct,o=class{constructor(t,e=0){E(this,b);E(this,lt);E(this,It);E(this,Et);E(this,it);E(this,at);E(this,st);E(this,ot);E(this,xt);E(this,v);l(this,"type",0);l(this,"value",null);l(this,"byteLength",0);l(this,"elementCount",0);let i=t.getUint8(e);e++;let s=o.prefixTypeMap.get(i);if(s)switch(s){case o.typeInt:h(this,b,rt).call(this,t,e,i);return;case o.typeNil:h(this,lt,_t).call(this,t,e,i);return;case o.typeBool:h(this,It,mt).call(this,t,e,i);return;case o.typeFloat:h(this,Et,Mt).call(this,t,e,i);return;case o.typeStr:h(this,it,Rt).call(this,t,e,i);return;case o.typeBin:h(this,at,St).call(this,t,e,i);return;case o.typeArray:h(this,st,Pt).call(this,t,e,i);return;case o.typeMap:h(this,ot,Tt).call(this,t,e,i);return;case o.typeExt:h(this,xt,kt).call(this,t,e,i);return;default:throw new Error("Should match exactly one type.")}if(i>=0&&i<=127)h(this,b,rt).call(this,t,e,i);else if(i>=224&&i<=255)h(this,b,rt).call(this,t,e,i);else if(i>=160&&i<=191)h(this,it,Rt).call(this,t,e,i);else if(i>=144&&i<=159)h(this,st,Pt).call(this,t,e,i);else if(i>=128&&i<=143)h(this,ot,Tt).call(this,t,e,i);else{let f=i.toString(16);throw console.error("Unknown first byte.",f),new Error(`Unknown first byte. (${f})`)}}},r=o;b=new WeakSet,rt=function(t,e,i){this.type=o.typeInt,i>=0&&i<=127?(this.byteLength=1,this.value=t.getUint8(e-1)):i>=224&&i<=255?(this.byteLength=1,this.value=t.getInt8(e-1)):i===204?(this.byteLength=2,this.value=t.getUint8(e)):i===205?(this.byteLength=3,this.value=t.getUint16(e,!1)):i===206?(this.byteLength=5,this.value=t.getUint32(e,!1)):i===207?(this.byteLength=9,this.value=t.getBigUint64(e,!1)):i===208?(this.byteLength=2,this.value=t.getInt8(e)):i===209?(this.byteLength=3,this.value=t.getInt16(e,!1)):i===210?(this.byteLength=5,this.value=t.getInt32(e,!1)):i===211&&(this.byteLength=9,this.value=t.getBigInt64(e,!1))},lt=new WeakSet,_t=function(t,e,i){this.type=o.typeNil,this.byteLength=1,this.value=null},It=new WeakSet,mt=function(t,e,i){this.type=o.typeBool,this.byteLength=1,this.value=i===195},Et=new WeakSet,Mt=function(t,e,i){this.type=o.typeFloat,i===202?(this.byteLength=5,this.value=t.getFloat32(e,!1)):i===203&&(this.byteLength=9,this.value=t.getFloat64(e,!1))},it=new WeakSet,Rt=function(t,e,i){this.type=o.typeStr;let s,f;i>=160&&i<=191?(s=0,f=i-160):i===217?(s=1,f=t.getUint8(e)):i===218?(s=2,f=t.getUint16(e)):i===219&&(s=4,f=t.getUint32(e)),this.byteLength=1+s+f;let a=h(this,v,ct).call(this,e,s,f);this.value=new TextDecoder().decode(t.buffer.slice(a.start,a.end))},at=new WeakSet,St=function(t,e,i){this.type=o.typeBin;let s,f;i===196?(s=1,f=t.getUint8(e)):i===197?(s=2,f=t.getUint16(e)):i===198&&(s=4,f=t.getUint32(e)),this.byteLength=1+s+f;let a=h(this,v,ct).call(this,e,s,f);this.value=t.buffer.slice(a.start,a.end)},st=new WeakSet,Pt=function(t,e,i){this.type=o.typeArray,this.value=[],i>=144&&i<=159?(this.byteLength=1,this.elementCount=i-144):i===220?(this.byteLength=3,this.elementCount=t.getUint16(e)):i===221&&(this.byteLength=5,this.elementCount=t.getUint32(e))},ot=new WeakSet,Tt=function(t,e,i){this.type=o.typeMap,this.value={},i>=128&&i<=143?(this.byteLength=1,this.elementCount=i-128):i===222?(this.byteLength=3,this.elementCount=t.getUint16(e)):i===223&&(this.byteLength=5,this.elementCount=t.getUint32(e))},xt=new WeakSet,kt=function(t,e,i){this.type=o.typeExt;let s,f;i===212?(s=0,f=1):i===213?(s=0,f=2):i===214?(s=0,f=4):i===215?(s=0,f=8):i===216?(s=0,f=16):i===199?(s=1,f=t.getUint8(e)):i===200?(s=2,f=t.getUint16(e)):i===201&&(s=4,f=t.getUint32(e)),this.byteLength=1+s+1+f;let a=t.getInt8(e+s),X=h(this,v,ct).call(this,e,s+1,f),ft=t.buffer.slice(X.start,X.end);if(a===-1){let ht=new DataView(ft);if(ft.byteLength===4){let p=ht.getUint32(0,!1);this.value=new w(p,0).toDate();return}if(ft.byteLength===8){let p=ht.getBigUint64(0,!1),ut=Number(p>>34n),Dt=Number(p&0x00000003ffffffffn);this.value=new w(Dt,ut).toDate();return}if(ft.byteLength===12){let p=ht.getUint32(0,!1),ut=Number(ht.getBigInt64(4,!1));this.value=new w(ut,p).toDate();return}throw new Error("Timestamp family only supports 32/64/96 bit.")}else throw new Error("Does not support unknown ext type.")},v=new WeakSet,ct=function(t,e=0,i=0){return{start:t+e,end:t+e+i}},l(r,"typeInt",1),l(r,"typeNil",2),l(r,"typeBool",3),l(r,"typeFloat",4),l(r,"typeStr",5),l(r,"typeBin",6),l(r,"typeArray",7),l(r,"typeMap",8),l(r,"typeExt",9),l(r,"prefixTypeMap",new Map([[204,o.typeInt],[205,o.typeInt],[206,o.typeInt],[207,o.typeInt],[208,o.typeInt],[209,o.typeInt],[210,o.typeInt],[211,o.typeInt],[192,o.typeNil],[194,o.typeBool],[195,o.typeBool],[202,o.typeFloat],[203,o.typeFloat],[217,o.typeStr],[218,o.typeStr],[219,o.typeStr],[196,o.typeBin],[197,o.typeBin],[198,o.typeBin],[220,o.typeArray],[221,o.typeArray],[222,o.typeMap],[223,o.typeMap],[199,o.typeExt],[200,o.typeExt],[201,o.typeExt],[212,o.typeExt],[213,o.typeExt],[214,o.typeExt],[215,o.typeExt],[216,o.typeExt]]));function Lt(n,t=!1){let e=new DataView(n),i=[],s=null,f=null,a=null,X=0;for(;X<e.byteLength;){if(f=new r(e,X),t&&console.log(`pos = ${X}, type = ${f.type}, val = ${f.value}, byteLength = ${f.byteLength}`),X+=f.byteLength,s!=null&&s.isMap)if(a)a&&(s.ref[a]=f.value,a=null,s.elementsLeft--);else{if(f.type!==r.typeStr)throw new Error("Map key should be a string.");a=f.value}else s!=null&&s.isArray&&(s.ref.push(f.value),s.elementsLeft--);for((f.type===r.typeMap||f.type===r.typeArray)&&(s&&i.push(s),s=new nt(f.value,f.type===r.typeMap,f.type===r.typeArray,f.elementCount));(s==null?void 0:s.elementsLeft)===0&&i.length;)s=i.pop()}return s!=null&&s.ref?s.ref:f.value}typeof window<"u"&&(window.MessagePackNodejs={encode:Ut,decode:Lt,...Xt});})();
